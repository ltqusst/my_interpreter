#!/bin/bash

set -e
set -v

g++ -g -O0 -fpermissive -o test1 ./test1.cpp


./test1 0 0
./test1 129 129
./test1 -129 -129
./test1 0x0 0x0
./test1 0x0a 0x0a
./test1 0xffffffff 0xffffffff
./test1 0xa0 0xa0
./test1 "  0xa0" 0xa0

./test1 -+129 -129
./test1 -+-++-129 -129
./test1 ~0x5555AAAA 0xFFFFFFFFAAAA5555
./test1 ~~0x5555AAAA 0x5555AAAA

#======= test for snum =======
./test1 -0xa0 -0xa0
./test1 !0xa0 0
./test1 !0x0 1
./test1 ~0x0 0xFFFFFFFFFFFFFFFF
./test1 ~0x1 0xFFFFFFFFFFFFFFFE

#======= test for t1 =======
./test1 1*2 $((1*2))
./test1 1123*21/2*0xA123 $((1123*21/2*0xA123))
./test1 1123*21/2*0xA123%512324 $((1123*21/2*0xA123%512324))

#======= test for t2 =======
./test1 1+2 $((1+2))
./test1 1+2*3 $((1+2*3))
./test1 1+2*3-4*5 $((1+2*3-4*5))


#======= test for bin ops  =======

./test1 "7>=8" $((7>=8))
./test1 "7<8" $((7<8))
./test1 "7 <= 7" $((7<=7))

./test1 "0x55 & 123 | 0xBACD" $((0x55 & 123 | 0xBACD))
./test1 "7 < 7 && 8-2>=6" $((7 < 7 && 8-2>=6))

./test1 "1+2*3>4*5" $((1+2*3>4*5))
./test1 "1+2*3<4*5" $((1+2*3<4*5))
./test1 "1+2*(3+4)*5" $((1+2*(3+4)*5))
./test1 "1+2*(3+(4+6)*5)*5" $((1+2*(3+(4+6)*5)*5))

./test1 "0x12345678 >> 1+2*3" $((0x12345678 >> 1+2*3))
./test1 "1+2*3 << 1+2*3" $((1+2*3 << 1+2*3))

#========= test ?: ================
./test1 "2>3?1:0" $((2>3?1:0))
./test1 "3>2?1:0" $((3>2?1:0))
./test1 "3>2?1:4>2?100:200" $((3>2?1:4>2?100:200))
./test1 "3!=3?1:2>4>2?100:200" $((3!=3?1:2>4>2?100:200))

#========= test comma ================
./test1 "1,2" $((1,2))
./test1 "234,9>8,3!=3?1:2>4>2?100:200" $((234,9>8,3!=3?1:2>4>2?100:200))

#========= test assign ================
./test1 "a=3" 3
./test1 "aaa=3,bbb=2,aaa*bbb+1" 7
./test1 "aaa=3,bbb=aaa*aaa-1,bbb=aaa*bbb+1, bbb+aaa" 28

./test1 "a=4,b=2,2>1?a:b=0,b" 2
./test1 "a=4,b=2,2>1?a:b=0,a" 0

./test1 "a=3,a+=2" 5
./test1 "a=3,a *= 2" 6
./test1 "a=3,a<<= 2" 12

./test1 "a=3,b=&a,*b=2,a" 2

